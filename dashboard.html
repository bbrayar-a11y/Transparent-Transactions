<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Transparent Transactions</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Simple Header -->
        <div style="padding: 20px; text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <h1>Welcome to Your Dashboard!</h1>
            <p>Account created successfully üéâ</p>
        </div>

        <!-- Quick Stats -->
        <div style="padding: 20px;">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Account Status</h3>
                    <p class="stat-amount">‚úÖ Active</p>
                    <small>Welcome to Transparent Transactions</small>
                </div>
                <div class="stat-card">
                    <h3>Your Balance</h3>
                    <p class="stat-amount">‚Çπ0.00</p>
                    <small>Start transacting!</small>
                </div>
                <div class="stat-card">
                    <h3>Trust Score</h3>
                    <p class="stat-amount">100%</p>
                    <small>New Member</small>
                </div>
            </div>

            <!-- Quick Actions -->
            <div style="margin-top: 30px; text-align: center;">
                <h3>Get Started</h3>
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 15px;">
                    <button class="btn btn-primary" onclick="showReferralCode()">
                        üéØ Get Referral Code
                    </button>
                    <button class="btn btn-secondary" onclick="addFirstContact()">
                        üë• Add First Contact
                    </button>
                    <button class="btn btn-success" onclick="makeFirstTransaction()">
                        üí∏ Make First Transaction
                    </button>
                </div>
            </div>

            <!-- User Info -->
            <div style="background: white; padding: 20px; border-radius: 10px; margin-top: 30px; text-align: center;">
                <h3>Your Account Information</h3>
                <div id="userInfo">
                    <p>Loading your information...</p>
                </div>
            </div>

            <!-- Session Test -->
            <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-top: 20px;">
                <h4>Session Test</h4>
                <button class="btn btn-info" onclick="testSession()">
                    üîÑ Test Session Persistence
                </button>
                <button class="btn btn-secondary" onclick="goToHome()">
                    üè† Go to Home
                </button>
                <button class="btn btn-logout" onclick="logout()">
                    üö™ Logout
                </button>
            </div>
        </div>
    </div>

    <script>
        // Load user info when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadUserInfo();
            checkSession();
        });

        function loadUserInfo() {
            const userData = localStorage.getItem('currentUser');
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    document.getElementById('userInfo').innerHTML = `
                        <p><strong>Name:</strong> ${user.fullName || 'Not set'}</p>
                        <p><strong>Phone:</strong> ${user.phone || 'Not set'}</p>
                        <p><strong>Email:</strong> ${user.email || 'Not set'}</p>
                        <p><strong>Member Since:</strong> ${new Date().toLocaleDateString()}</p>
                    `;
                } catch (error) {
                    document.getElementById('userInfo').innerHTML = '<p>Error loading user info</p>';
                }
            } else {
                document.getElementById('userInfo').innerHTML = '<p>No user session found</p>';
            }
        }

        function checkSession() {
            const userData = localStorage.getItem('currentUser');
            if (!userData) {
                alert('No session found! Redirecting to login...');
                window.location.href = 'login.html';
                return;
            }
            
            console.log('Session check passed:', JSON.parse(userData));
        }

        function showReferralCode() {
            const userData = localStorage.getItem('currentUser');
            if (userData) {
                const user = JSON.parse(userData);
                const referralCode = `TT${user.phone.slice(-6)}${Math.random().toString(36).substr(2, 3).toUpperCase()}`;
                alert(`Your Referral Code: ${referralCode}\n\nShare this with friends to earn commissions!`);
            } else {
                alert('Please login first');
            }
        }

        function addFirstContact() {
            alert('Add contact feature would open here');
        }

        function makeFirstTransaction() {
            alert('Make transaction feature would open here');
        }

        function testSession() {
            const userData = localStorage.getItem('currentUser');
            if (userData) {
                alert('‚úÖ Session is persistent! User data found in localStorage.');
                console.log('Current session:', JSON.parse(userData));
            } else {
                alert('‚ùå No session found! This is the issue.');
            }
        }

        function goToHome() {
            window.location.href = 'index.html';
        }

        function logout() {
            localStorage.removeItem('currentUser');
            alert('Logged out successfully');
            window.location.href = 'index.html';
        }

        // Prevent redirect if we have a session
        const userData = localStorage.getItem('currentUser');
        if (!userData) {
            console.log('No user session, allowing potential redirect');
        } else {
            console.log('User session found, blocking redirects');
            // Override any redirect attempts
            window.location.href = window.location.href;
        }
    </script>
</body>
</html>
